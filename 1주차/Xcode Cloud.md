# Xcode Cloud

* Xcode에서 애플의 다양한 OS(iOS, MacOS, WatchOS...)들을 위해 제공하는 CI/CD 툴

## CI/CD란?
* CI는 Continuous Integration의 약자로 직역하면 지속적인 통합이라는 뜻임. 조금 풀어서 설명해보면, 여러 팀원들이 각자의 브랜치에서 코드를 작성하고 수정하는 등의 행동이 일어남. 각자의 코드들이 하나로 합쳐지면서 팀이 운영하는 서비스에 큰 영향을 줄 수 있음. 갑자기 빌드가 안된다던지 크래시가 많이 일어난다던지 등등. 이러한 일이 발생하는 것을 방지하기 위해 코드들이 병합되는 과정에서 '지속적 통합' 프로세스가 필요함. 해당 프로세스는 병합되는 코드들을 자동으로 빌드하고 테스트하는 등의 과정을 의미함.
* CD는 Continuous Delivery 또는 Deployment의 약자로 직역하면 지속적인 제공이라는 뜻임. 요것도 마찬가지로 풀어서 설명해보면, CI가 끝나게 되면 우리의 서비스는 이제 배포할 수 있는 준비가 된 것임. 준비가 된 서비스를 지속적으로 유저 또는 테스터들에게 제공하는 과정을 CD라고 함.

## 왜 사용해야할까?
* 여러 feature가 추가되어 앱의 규모가 커지고 여러 플랫폼을 지원하게될 때, 즉 앱이 점점 확장되어나갈 때 우리는 앱의 퀄리티를 보장하기 힘들어지는 시기가 찾아오게 됨. 정말 앱이 안정성있게 돌아가고 있는지, 또는 무언가 새로운 피처가 추가될 때 사이드 이펙트를 유발하진 않을지 보장할 수 없음.
* 이러한 상황일 때, Xcode Cloud는 앱의 퀄리티와 안정성을 보장하는데에 큰 역할을 할 수 있음.
* 뿐만 아니라, 일일히 챙기기 번거로운 작업(빌드 - 테스트 - 아카이빙 - 테스트 플라이트 업로드)들을 한 번에 자동화할 수 있음
* 무엇보다도 애플이 아주 최근에(2021년) 제공한 퍼스트 파티 툴임. 믿고 갈 만함.

## Xcode Cloud 사용 시 얻을 수 있는 이점
* 빌드와 테스트를 자동화할 수 있음
* 다양한 시뮬레이터(특정 디바이스도 가능)에서 앱을 테스트해볼 수 있음
* 에러, 테스트 실패, 빌드 성공시 등 특정 상황에서 개발자가 알림을 받아볼 수 있음
* 테스트플라이트에 자동으로 배포할 수 있음
* Xcode내에서 뿐만아니라 앱스토어 커넥트에서도 직관적으로 워크플로우를 관리할 수 있음(fastlane으로는 줄 수 없는 경험)

## Xcode Cloud의 Privacy 정책
* 우리들의 소스코드가 우리 프로젝트의 심장같은 역할을 하기때문에 보안성은 특히 더 중요함
* 빌드 환경은 일시적으로만 유지됨
* Xcode Cloud에서 빌드나 테스트를 위해 활용되어지는 소스 코드들은 절대 '저장'되지 않음. 일시적으로 사용함(GitHub의 Copilot이 생각나는 정책)
* 빌드 데이터는 암호화되어짐. 해당 데이터는 개발자가 언제든 삭제할 수 있음

# Xcode Cloud 세팅하기
* 우선 세팅을 하려면 remote repository가 있어야함
* 구체적인 설치방법은 아래 레퍼런스에서 잘 설명하고 있으니 해당 영상 참고
* https://developer.apple.com/videos/play/wwdc2021/10267/ (5:56부터 세팅법 설명)

## Workflow
* 워크플로우는 내가 자동화해서 넣고자 하는 작업들(ex. 빌드, 테스트, 아카이빙 등)의 조합 단위라고 이해하면 될 듯
* Xcode내에서 우리는 워크플로우를 직관적으로 우리 입맛대로 커스터마이징 해줄 수 있음(fastlane처럼 일일히 script로 작성 안해도됨. 진짜 최고. 물론 Xcode Cloud도 custom script 작성 가능)

![스크린샷 2022-11-15 오전 12 29 19](https://user-images.githubusercontent.com/87598209/201700281-0cee1095-6350-4d79-bf1a-ec09720016f5.png)
* 위 사진처럼 어떤 상황(type)일 때, 워크플로우를 실행시킬지 정할 수 있고 어떤 브랜치에서 실행시킬지도 지정해줄 수 있음
* 또한 액션들도 커스터마이징 가능

![스크린샷 2022-11-15 오전 12 30 14](https://user-images.githubusercontent.com/87598209/201700274-84775388-3c85-4aae-91ac-282b7758f852.png)
* 위 사진은 워크플로우에 테스트 액션을 추가하였음
* 테스트 액션도 추천되는 시뮬레이터에서 시킬지 혹은 특정 기기에서만 시킬지 지정해줄 수 있음

![스크린샷 2022-11-15 오전 12 31 45](https://user-images.githubusercontent.com/87598209/201700248-afa94a20-d890-4a57-bcd5-d29a8f09d6a1.png)
* 평상시에는 Xcode Report Navigator 영역에서 이렇게 편하게 전체 워크플로우 현황을 확인해볼 수 있음

# Xcode Cloud 기존 도구에 통합시키기(Webhook)
* 우리는 개발과정 중에 사용 중인 여러 툴들이 분명 존재할 것임(지라, 디스코드, 슬랙 등등)
* 웹후크를 통해 우리는 Xcode Cloud를 기존에 사용 중인 툴들에 통합시킬 수 있음
* 가령, PR이 머지되는 과정이라던지, 빌드 정보라던지, 이슈가 열리고 닫힌다던지 요런 정보들을 모두 우리가 사용 중인 툴들에 알려줄 수 있음
* 최대 5개의 웹후크까지만 설정할 수 있음
* 웹후크 세팅에 관한 방법은 아래 레퍼런스에서 잘 설명하고 있으니 해당 영상 참조
* https://developer.apple.com/videos/play/wwdc2021/10269 (16:52부터 Webhook 설명)

![스크린샷 2022-11-15 오전 1 38 36](https://user-images.githubusercontent.com/87598209/201718103-c8559511-b5ac-4720-be68-1df4d58e07f0.png)
* 빌드의 라이프사이클 각 순간(Create Build, Start Build, Complete Build)마다 다른 알림을 줄 수 있음

![스크린샷 2022-11-15 오전 1 41 03](https://user-images.githubusercontent.com/87598209/201718092-8d2c43d1-9d55-4d4b-8412-44308e5f253b.png)
* Payload는 다음과 같은 Content들을 가지고 있음

![스크린샷 2022-11-15 오전 1 44 11](https://user-images.githubusercontent.com/87598209/201718061-b0ccc317-3539-470d-88d5-7bc71a4e81a7.png)
* JSON 형태로 오는 Payload를 디코딩 해주고 있음
* 디코딩 해준 결과에 따라, 조건문을 통과하면 Twitter로 알림을 주고 있는걸 확인할 수 있음
