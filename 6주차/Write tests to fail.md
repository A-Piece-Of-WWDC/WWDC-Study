# Write tests to fail

- 실패하는 테스트들에 대해 단순히 실패한 테스트를 디버깅 하는 것에 끝나는게 아니라 얼마나 실패한 테스트들을 잘 분류하여 효율적으로 관리할 것인가에 대해 포커스를 맞춘 느낌의 세션
- 실패하는 테스트들을 잘 분류함으로써, 우리는 이슈들을 좀 더 빠르게 진단하고 빠르게 해결할 수 있게될 수 있다.

각각의 테스트 케이스들은 다음과 같은 단계로 구성된다

- Set Up
- Test: actions
- Test: assertions
- Tear down

## Set Up

- 테스트를 Set Up하는 단계는 테스트에 대해 사전 준비를 하는 단계이다
- 모든 테스트에서 테스트가 실행되기 전에 항상 불려지는 메서드로 앱의 state나 테스트를 위한 적절한 환경 설정을 해당 메서드에서 설정해준다

![스크린샷 2022-12-22 오전 1.30.59.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ec5cb831-f4d8-4ea9-8d80-4718f54adf94/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-12-22_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_1.30.59.png)
![스크린샷 2022-12-22 오전 1 30 59](https://user-images.githubusercontent.com/87598209/209439374-ac9a8933-c7bb-4810-8e4c-c1c0099e3d63.png)

- 위의 예시 코드를 보면, 테스트를 하기 전에 몇 가지 설정을 해주고 있다
- continueAfterFailure의 경우, 테스트에서 이슈가 발견됐을 때 테스트를 지속할지 말지를 결정하는 프로퍼티이다
- 앱에 argument를 추가해줌으로써, 앱내 탭의 state를 설정해주고 있다
- 탭을 지정해줌으로써, 불필요하게 다른 탭에서 발생할 수 있는 이슈들을 차단할 수 있다. 즉 테스트 분류가 간편해진다(속도도 증가함)

- 정리하면, Set Up 단계를 통해 테스트의 에러 핸들링을 좀 더 수월하게 할 수 있다

## Test: actions

- 테스트의 액션들은 구체적으로 테스트내에서 어떤 로직을 실행할지를 결정
- 테스트의 이름은 반드시 테스트가 어떤 액션을 하는지, 어떤 것을 검증하려고 하는지 명확한 목적성을 띄어야함
- 테스트에서 액션의 수는 가능한 최소화 하는 것이 좋음

- 테스트를 하기에 앞서, 만약 string과 같이 자주자주 변하는 value들을 다루게 된다면 enum으로 관리하는 편이 훨씬 효율적이고 관련 테스트를 수정하는데에 용이함
    
![스크린샷 2022-12-22 오전 11 04 06](https://user-images.githubusercontent.com/87598209/209439407-32ba6045-9ff5-4174-ab11-0bf807570a78.png)

- 위의 예시 코드의 경우 만약 “Berry Blue”에서 “Berrylicious”로 값이 바뀌었을 때 enum으로 관리해두면 rawValue값만 수정하면은 끝. 만약 일일이 하드코딩 해두었다면 테스트 코드에서 변화의 소요가 생기게 됨
    
![스크린샷 2022-12-22 오전 11 06 30](https://user-images.githubusercontent.com/87598209/209439412-55d3d0db-806b-4146-9041-ffd5116abfbc.png)

- 테스트 코드베이스가 여러 어플리케이션이 공유해서 사용하고 있고 특정 테스트 코드를 여러 어플리케이션에서 검증해야할 필요성이 있으면 해당 테스트 코드들을 패키징해서 SPM으로 활용하거나 프레임워크를 만들자

## **Test: assertions**

- assertion은 테스트가 올바르게 수행되고 있는지 검증하는 단계
- XCTAssert로 시작하는 각각의 메서드들에 description을 가능한 상세하게 적어주는 것은 테스트의 이슈를 분류하고 해결하는데에 큰 도움을 줄 수 있다

![스크린샷 2022-12-22 오전 11 17 13](https://user-images.githubusercontent.com/87598209/209439414-85841510-5ede-4f99-b0c4-270c9e915541.png)

- 단순히 description없이 이렇게 만들면, 우리는 3과 2과 다른건 알지만 2가 대체 무슨 결과로 나온 값인지 정확히 알 수가 없음
    
![스크린샷 2022-12-22 오전 11 18 06](https://user-images.githubusercontent.com/87598209/209439426-1aa724a7-e2d6-4976-aa6a-a3298e271173.png)

- description을 위와 같이 상세하게 적어주면, 좀 더 이슈를 분류하고 해결하기에 용이하다

- assertion관련 메서드들로는 아래와 같은 메서드들이 존재한다

![스크린샷 2022-12-22 오전 11 19 59](https://user-images.githubusercontent.com/87598209/209439429-a67bc302-ed2f-4691-9481-06729f84c8f7.png)

- 테스트 코드 상에서 옵셔널을 언래핑 해야할 때, 테스트 코드니까 귀찮다고 force 언래핑하면은 만약 nil값이 나왔을 때 크래시가 발생하여 테스트에 문제를 일으킬 수 있다.
- 가급적이면 옵셔널을 언래핑해서 사용하는걸 권장하는데 테스트에서 쓸 수 있는 언래핑방법이 하나 더 있음

![스크린샷 2022-12-22 오전 11 23 48](https://user-images.githubusercontent.com/87598209/209439430-3fe4dc67-fe46-499d-bfc6-e6a58220436f.png)

- XCTUnwrap은 guard let문을 테스트코드에 맞게 좀 더 단순화한 버전이다.
- 이렇게 언래핑을 해줌으로써, 우리는 크래시대신 테스트 실패메시지를 확인하고 테스트 이슈를 분류하고 해결해줄 수 있다
- tearDown 메서드도 안전하게 호출이 될 것임

<img width="1606" alt="스크린샷 2022-12-22 오후 6 24 45" src="https://user-images.githubusercontent.com/87598209/209439451-9012c158-2105-4703-8a1e-1c1c5aab240d.png">

- 테스트 이슈 분류를 위해 XCTSkip, XCTSkipIf, XCTSkipUnless 메서드를 적극적으로 활용하자. 만약 해당 테스트들을 실행하기에 적절하지 않은 상황이거나 특정 플랫폼에서는 테스트가 적합하지 않다면 위의 메서드를 사용해서 테스트를 생략하도록 하자
- 이렇게 테스트를 skip 하는 것은 빠른 시기에 수정할 테스트 코드나 테스트 코드가 프로덕션 코드보다 더 빨리 쓰여졌을 때, 유용하게 사용되어질 수 있다.
- 개인적으로 사실 테스트를 skip할거면 뭐하러 테스트 코드를 작성하지? 라는 생각을 했는데, 스킵으로 처리해두면 계속해서 해당 테스트에 대해 개발자에게 리마인드를 시켜준다는 점에서 의미가 있는듯

## Tear Down

- 테스트 실행 후 마지막으로 실행되는 단계로,  state의 변화 등 app에서 변화한 부분들을 초기화 해주는 단계이다
- 꼭 테스트를 하면서 무언가 바꿔준게 있다면 여기서 초기화 시켜주자
